<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lead-Gen Partenaires ‚Äî Dashboard</title>
    <!-- Tailwind (CDN runtime) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@0.344.0/dist/umd/lucide.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ctext y='50' font-size='48'%3Eü§ù%3C/text%3E%3C/svg%3E" />
    <style>
      :root { color-scheme: light dark; }
      .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.6); }
      @media (prefers-color-scheme: dark){ .glass{ background: rgba(15,15,20,.55);} }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 dark:from-slate-950 dark:to-indigo-950 text-slate-900 dark:text-slate-100">
    <div id="root"></div>

    <script type="text/javascript">
      const { useState, useEffect, useMemo } = React;

      const api = {
        async health() {
          const r = await fetch('/api/health');
          if(!r.ok) throw new Error('Health check failed');
          return r.json();
        },
        async credits(userId){
          const r = await fetch('/api/credits?user_id=' + encodeURIComponent(userId));
          const data = await r.json().catch(()=> ({}));
          if(!r.ok) throw new Error(data?.error || 'Failed to fetch balance');
          return data;
        }
      };

      function Badge({ ok }) {
        return (
          <span className={"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-medium " + 
            (ok ? "bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-200"
                : "bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-200")}>
            <span className={"h-2 w-2 rounded-full " + (ok ? "bg-emerald-500":"bg-rose-500")}></span>
            {ok ? "API OK":"API KO"}
          </span>
        );
      }

      function Section({title,children,actions}) {
        return (
          <section className="glass rounded-2xl shadow-xl border border-white/20 dark:border-white/10 p-6">
            <div className="flex items-center justify-between gap-2 mb-4">
              <h2 className="text-lg font-semibold">{title}</h2>
              {actions}
            </div>
            {children}
          </section>
        );
      }

      function CreditsPanel(){
        const [userId,setUserId] = useState("");
        const [loading,setLoading] = useState(false);
        const [data,setData] = useState(null);
        const [error,setError] = useState("");

        async function fetchCredits(){
          setLoading(true); setError(""); setData(null);
          try{
            if(!userId.trim()) throw new Error("Veuillez entrer un user_id (UUID).");
            const res = await api.credits(userId.trim());
            setData(res);
          }catch(e){ setError(e.message); }
          finally{ setLoading(false); }
        }

        return (
          <Section title="Cr√©dits & Utilisation" actions={
            <button onClick={fetchCredits}
              className="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white disabled:opacity-60"
              disabled={loading}>
              {loading ? "Chargement‚Ä¶" : "Actualiser"}
            </button>
          }>
            <div className="grid gap-4 sm:grid-cols-[1fr_auto] items-end">
              <label className="block">
                <span className="text-sm text-slate-500">user_id (UUID Neon)</span>
                <input value={userId} onChange={e=>setUserId(e.target.value)}
                  placeholder="ex: 18a1e7fa-4a3d-4a19-9d66-xxxxxxxxxxxx"
                  className="mt-1 w-full rounded-lg border border-slate-300/60 dark:border-slate-700 bg-white/70 dark:bg-slate-900/40 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500"/>
              </label>
              <button onClick={fetchCredits}
                className="h-10 px-4 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white disabled:opacity-60"
                disabled={loading}>{loading ? "‚Ä¶" : "Voir le solde"}</button>
            </div>

            <div className="mt-4">
              {error && <div className="rounded-lg border border-rose-200/60 dark:border-rose-900/50 bg-rose-50/70 dark:bg-rose-950/30 text-rose-800 dark:text-rose-200 p-3 text-sm">{error}</div>}
              {data && (
                <div className="rounded-lg border border-emerald-200/60 dark:border-emerald-900/50 bg-emerald-50/70 dark:bg-emerald-950/30 p-4">
                  <div className="text-sm text-emerald-700 dark:text-emerald-200">R√©ponse</div>
                  <pre className="mt-2 text-sm overflow-x-auto">{JSON.stringify(data,null,2)}</pre>
                </div>
              )}
              {!data && !error && <p className="text-sm text-slate-500 mt-1">Entrez un <code>user_id</code> puis cliquez sur ‚ÄúVoir le solde‚Äù.</p>}
            </div>
          </Section>
        );
      }

      function LeadsPanel(){
        return (
          <Section title="Leads (d√©mo)">
            <p className="text-sm text-slate-500">Espace pour lister/cr√©er des leads. Vous pouvez brancher ici votre endpoint futur (ex: <code>/api/leads</code>).</p>
            <div className="mt-4 grid gap-3 sm:grid-cols-2">
              <div className="p-4 rounded-xl border border-slate-200/60 dark:border-slate-800 bg-white/60 dark:bg-slate-900/40">
                <label className="block text-sm">Nom</label>
                <input className="mt-1 w-full rounded-lg border border-slate-300/60 dark:border-slate-700 bg-white/70 dark:bg-slate-900/40 px-3 py-2 outline-none"/>
              </div>
              <div className="p-4 rounded-xl border border-slate-200/60 dark:border-slate-800 bg-white/60 dark:bg-slate-900/40">
                <label className="block text-sm">Email</label>
                <input className="mt-1 w-full rounded-lg border border-slate-300/60 dark:border-slate-700 bg-white/70 dark:bg-slate-900/40 px-3 py-2 outline-none"/>
              </div>
            </div>
            <button className="mt-4 px-4 py-2 rounded-lg bg-slate-800 text-white/90 hover:bg-slate-700 disabled:opacity-60" disabled>Soumettre (√† brancher)</button>
          </Section>
        );
      }

      function PartnersPanel(){
        const partners = useMemo(()=>[
          {name:"Zapier", status:"actif", leads:128},
          {name:"Notion", status:"en pause", leads:42},
          {name:"Airtable", status:"actif", leads:73},
        ],[]);
        return (
          <Section title="Partenaires">
            <div className="overflow-x-auto rounded-xl border border-slate-200/60 dark:border-slate-800">
              <table className="w-full text-sm">
                <thead className="bg-slate-50/70 dark:bg-slate-900/30">
                  <tr className="text-left text-slate-500">
                    <th className="px-4 py-2">Nom</th>
                    <th className="px-4 py-2">Statut</th>
                    <th className="px-4 py-2">Leads</th>
                    <th className="px-4 py-2 text-right">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {partners.map(p=>(
                    <tr key={p.name} className="border-t border-slate-200/60 dark:border-slate-800">
                      <td className="px-4 py-2">{p.name}</td>
                      <td className="px-4 py-2">
                        <span className={"px-2 py-1 rounded-full text-xs "+(p.status==="actif"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-200":"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-200")}>{p.status}</span>
                      </td>
                      <td className="px-4 py-2">{p.leads}</td>
                      <td className="px-4 py-2 text-right">
                        <button className="text-indigo-600 hover:underline" disabled>Configurer (√† brancher)</button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </Section>
        );
      }

      function BillingPanel(){
        return (
          <Section title="Billing">
            <p className="text-sm text-slate-500">Int√©gration Stripe √† brancher ici (Checkout ou Customer Portal). Le bouton ci-dessous est un placeholder.</p>
            <button className="mt-3 px-4 py-2 rounded-lg bg-fuchsia-600 text-white hover:bg-fuchsia-500" disabled>
              Acheter des cr√©dits (Stripe √† brancher)
            </button>
          </Section>
        );
      }

      function App(){
        const [health,setHealth] = useState(null);
        useEffect(()=>{
          api.health().then(setHealth).catch(()=>setHealth({ok:false}));
        },[]);
        return (
          <main className="mx-auto max-w-6xl p-6 sm:p-10 space-y-8">
            <header className="flex items-center justify-between gap-4">
              <div>
                <h1 className="text-2xl font-bold tracking-tight">Lead-Gen Partenaires</h1>
                <p className="text-sm text-slate-500">Console d‚Äôorchestration et de mon√©tisation</p>
              </div>
              <div className="flex items-center gap-3">
                <Badge ok={!!health?.ok}/>
                <a href="https://leadgen-agent.vercel.app/api/health" className="text-xs text-slate-500 hover:underline">/api/health</a>
              </div>
            </header>

            <div className="grid gap-6 md:grid-cols-2">
              <CreditsPanel/>
              <LeadsPanel/>
            </div>

            <div className="grid gap-6 md:grid-cols-2">
              <PartnersPanel/>
              <BillingPanel/>
            </div>

            <footer className="pt-6 text-center text-xs text-slate-500">
              ¬© {new Date().getFullYear()} Lead-Gen Partenaires ‚Äî v1.0
            </footer>
          </main>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
  </body>
</html>
